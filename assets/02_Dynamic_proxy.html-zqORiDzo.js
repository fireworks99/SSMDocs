import{_ as l,c,d as s,a as o,b as p,w as e,r as i,o as u,e as t}from"./app-1Rf4Bye1.js";const k={},r={class:"table-of-contents"};function d(m,n){const a=i("router-link");return u(),c("div",null,[n[5]||(n[5]=s("h1",{id:"åŠ¨æ€ä»£ç†æ¨¡å¼",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#åŠ¨æ€ä»£ç†æ¨¡å¼"},[s("span",null,"åŠ¨æ€ä»£ç†æ¨¡å¼")])],-1)),s("nav",r,[s("ul",null,[s("li",null,[p(a,{to:"#_1-å‰è¨€"},{default:e(()=>[...n[0]||(n[0]=[t("1.å‰è¨€",-1)])]),_:1})]),s("li",null,[p(a,{to:"#_2-jdkåŠ¨æ€ä»£ç†"},{default:e(()=>[...n[1]||(n[1]=[t("2.JDKåŠ¨æ€ä»£ç†",-1)])]),_:1})]),s("li",null,[p(a,{to:"#_3-cglibåŠ¨æ€ä»£ç†"},{default:e(()=>[...n[2]||(n[2]=[t("3.CGLIBåŠ¨æ€ä»£ç†",-1)])]),_:1})]),s("li",null,[p(a,{to:"#_4-æ‹¦æˆªå™¨"},{default:e(()=>[...n[3]||(n[3]=[t("4.æ‹¦æˆªå™¨",-1)])]),_:1})]),s("li",null,[p(a,{to:"#_5-æ€»ç»“"},{default:e(()=>[...n[4]||(n[4]=[t("5.æ€»ç»“",-1)])]),_:1})])])]),n[6]||(n[6]=o(`<h2 id="_1-å‰è¨€" tabindex="-1"><a class="header-anchor" href="#_1-å‰è¨€"><span>1.å‰è¨€</span></a></h2><p>Javaæœ‰å¤šç§åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œæ¯”å¦‚JDKã€CGLIBã€Javassistã€ASMï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„åŠ¨æ€ä»£ç†æŠ€æœ¯æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯ JDK åŠ¨æ€ä»£ç†ï¼Œè¿™æ˜¯ JDK è‡ªå¸¦çš„åŠŸèƒ½ï¼›å¦ä¸€ç§æ˜¯ CGLIBï¼Œè¿™æ˜¯ç¬¬ä¸‰æ–¹æä¾›çš„ä¸€ç§æŠ€æœ¯ã€‚ç›®å‰ Spring å¸¸ç”¨ JDKå’ŒCGLIBï¼Œè€Œ MyBatis è¿˜ä½¿ç”¨ Javassist ï¼Œæ— è®ºå“ªç§ä»£ç†å…¶æŠ€æœ¯ï¼Œå®ƒä»¬çš„ç†å¿µéƒ½æ˜¯ç›¸ä¼¼çš„ã€‚</p><blockquote><p>åå°„ä¸åŠ¨æ€ä»£ç†çš„å…³ç³»ï¼š</p><ul><li>åå°„æ˜¯åŸºç¡€æŠ€æœ¯</li><li>åŠ¨æ€ä»£ç†æ˜¯åŸºäºåå°„å®ç°çš„<strong>è®¾è®¡æ¨¡å¼</strong></li></ul></blockquote><h2 id="_2-jdkåŠ¨æ€ä»£ç†" tabindex="-1"><a class="header-anchor" href="#_2-jdkåŠ¨æ€ä»£ç†"><span>2.JDKåŠ¨æ€ä»£ç†</span></a></h2><p>ç‰¹ç‚¹ï¼šåŸºäºJavaè‡ªå¸¦çš„ç±»ï¼ˆjava.lang.reflect.Proxyï¼‰å®ç°ï¼Œè¿™ä¸ªç±»æ¶‰åŠåˆ°æ¥å£ï¼Œè¿™ä¹Ÿæ„å‘³ç€JDKåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†<strong>æ¥å£</strong>ï¼Œç±»ä¸è¡Œï¼Œç±»è¦ç”¨CGLIBã€‚</p><table><thead><tr><th>JDKåŠ¨æ€ä»£ç†</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç”¨é€”</td><td>ç»™æ¥å£å®ç°ç±»â€œåŠ å£³â€å¢å¼ºåŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ã€å®‰å…¨ã€äº‹åŠ¡ï¼‰</td></tr><tr><td>åŸç†</td><td>ä½¿ç”¨ Java åå°„ + <code>Proxy</code> åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡</td></tr><tr><td>é™åˆ¶</td><td>åªèƒ½ä»£ç†<strong>æ¥å£</strong>ï¼ˆç±»ä¸è¡Œï¼Œç±»è¦ç”¨ CGLIBï¼‰</td></tr></tbody></table><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>learn<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>chapter2<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>learn<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>chapter2<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldImpl</span> <span class="token keyword">implements</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>learn<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>chapter2<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdkProxyExample</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// çœŸå®å¯¹è±¡</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">Object</span> target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 1.å»ºç«‹ä»£ç†å¯¹è±¡ä¸çœŸå®å¯¹è±¡çš„ä»£ç†å…³ç³»ï¼Œå¹¶è¿”å›ä»£ç†å¯¹è±¡</span></span>
<span class="line">    <span class="token comment">// Proxy.newProxyInstanceç¬¬äºŒä¸ªå‚æ•°é™åˆ¶äº†JDKåŠ¨æ€ä»£ç†åªé€‚åº”æ¥å£ç±»å‹ï¼Œä¸èƒ½ç›´æ¥ä»£ç†ç±»</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span><span class="token comment">//æœ¬è¯¥æ”¾åˆ°æ„é€ å‡½æ•°ä¸­ï¼Œè¿™é‡Œé¡ºä¾¿åšäº†</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2.å®ç°ä»£ç†é€»è¾‘</span></span>
<span class="line">    <span class="token comment">// å½“è°ƒç”¨ä»£ç†å¯¹è±¡çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ª invoke() æ–¹æ³•å°±ä¼šè¢«è§¦å‘ã€‚</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åœ¨è°ƒåº¦çœŸå®å¯¹è±¡ä¹‹å‰çš„æœåŠ¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// è¿™è¡Œä»£ç ç›¸å½“äºè°ƒåº¦çœŸå®å¯¹è±¡çš„æ–¹æ³•ï¼Œåªæ˜¯é€šè¿‡åå°„å®ç°è€Œå·²ã€‚</span></span>
<span class="line">        <span class="token class-name">Object</span> obj <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¿é—® å½“å‰ç±»çš„æˆå‘˜å˜é‡ æ—¶ï¼Œå¯çœç•¥this</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åœ¨è°ƒåº¦çœŸå®å¯¹è±¡ä¹‹åçš„æœåŠ¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> obj<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// 5.JDKåŠ¨æ€ä»£ç†</span></span>
<span class="line"><span class="token class-name">JdkProxyExample</span> jdk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdkProxyExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">HelloWorld</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HelloWorld</span><span class="token punctuation">)</span> jdk<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloWorldImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">proxy<span class="token punctuation">.</span><span class="token function">sayHelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™è¡Œä»£ç ä¼šå»æ‰§è¡Œä»£ç†å¯¹è±¡çš„invokeæ–¹æ³•</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * åœ¨è°ƒåº¦çœŸå®å¯¹è±¡ä¹‹å‰çš„æœåŠ¡</span>
<span class="line"> * Hello World</span>
<span class="line"> * åœ¨è°ƒåº¦çœŸå®å¯¹è±¡ä¹‹åçš„æœåŠ¡</span>
<span class="line"> */</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-cglibåŠ¨æ€ä»£ç†" tabindex="-1"><a class="header-anchor" href="#_3-cglibåŠ¨æ€ä»£ç†"><span>3.CGLIBåŠ¨æ€ä»£ç†</span></a></h2><p>JDK åŠ¨æ€ä»£ç†å¿…é¡»æä¾›æ¥å£æ‰èƒ½ä½¿ç”¨ï¼Œåœ¨ä¸€äº›ä¸èƒ½æä¾›æ¥å£çš„ç¯å¢ƒä¸­ï¼Œåªèƒ½é‡‡ç”¨å…¶ä»–ç¬¬ä¸‰æ–¹æŠ€æœ¯ï¼Œ æ¯”å¦‚ CGLIB åŠ¨æ€ä»£ç†ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>learn<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>chapter2<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">Enhancer</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodInterceptor</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodProxy</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CglibProxyExample</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 1.å»ºç«‹ä»£ç†å¯¹è±¡ä¸çœŸå®å¯¹è±¡çš„ä»£ç†å…³ç³»ï¼Œå¹¶è¿”å›ä»£ç†å¯¹è±¡</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">Class</span> cls<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//è®¾ç½®å¢å¼ºç±»å‹</span></span>
<span class="line">        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//å®šä¹‰ä»£ç†å¯¹è±¡ä¸ºå½“å‰å¯¹è±¡ï¼Œè¦æ±‚å½“å‰å¯¹è±¡å®ç° MethodInterceptor æ–¹æ³•</span></span>
<span class="line">        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//ç”Ÿæˆå¹¶è¿”å›ä»£ç†å¯¹è±¡</span></span>
<span class="line">        <span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2.å®ç°ä»£ç†é€»è¾‘</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨çœŸå®å¯¹è±¡å‰&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//CGLIB åå°„è°ƒç”¨çœŸå®å¯¹è±¡æ–¹æ³•</span></span>
<span class="line">        <span class="token class-name">Object</span> result <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è°ƒç”¨çœŸå®å¯¹è±¡å&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// 6.CglibåŠ¨æ€ä»£ç†</span></span>
<span class="line"><span class="token class-name">CglibProxyExample</span> cpe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibProxyExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">ReflectServiceImpl</span> obj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ReflectServiceImpl</span><span class="token punctuation">)</span> cpe<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">ReflectServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">&quot;Wendy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™è¡Œä»£ç ä¼šå»æ‰§è¡Œä»£ç†å¯¹è±¡çš„interceptæ–¹æ³•</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * è°ƒç”¨çœŸå®å¯¹è±¡å‰</span>
<span class="line"> * Hello, Wendy</span>
<span class="line"> * è°ƒç”¨çœŸå®å¯¹è±¡å</span>
<span class="line"> */</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-æ‹¦æˆªå™¨" tabindex="-1"><a class="header-anchor" href="#_4-æ‹¦æˆªå™¨"><span>4.æ‹¦æˆªå™¨</span></a></h2><blockquote><p>åå°„ä¸åŠ¨æ€ä»£ç†ä¸æ‹¦æˆªå™¨çš„å…³ç³»ï¼š</p><ul><li>åå°„æ˜¯åŸºç¡€æŠ€æœ¯</li><li>åŠ¨æ€ä»£ç†æ˜¯<strong>åŸºäºåå°„</strong>å®ç°çš„<strong>è®¾è®¡æ¨¡å¼</strong></li><li>æ‹¦æˆªå™¨æ˜¯<strong>åŸºäºä»£ç†</strong>å®ç°çš„åº”ç”¨åœºæ™¯</li></ul></blockquote><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>learn<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>chapter2<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>learn<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>chapter2<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterceptorJdkProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span><span class="token comment">//çœŸå®å¯¹è±¡</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> interceptorClass <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//æ‹¦æˆªå™¨å…¨é™å®šå</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//ç±»çš„æ„é€ å‡½æ•°</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">InterceptorJdkProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> interceptorClass<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorClass <span class="token operator">=</span> interceptorClass<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 1.å»ºç«‹ä»£ç†å¯¹è±¡ä¸çœŸå®å¯¹è±¡çš„ä»£ç†å…³ç³»ï¼Œå¹¶è¿”å›ä»£ç†å¯¹è±¡</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> interceptorClass<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token keyword">new</span> <span class="token class-name">InterceptorJdkProxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> interceptorClass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2.å®ç°ä»£ç†é€»è¾‘</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>interceptorClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//æ²¡æœ‰æ‹¦æˆªå™¨åˆ™ç›´æ¥åå°„åŸæœ‰æ–¹æ³•</span></span>
<span class="line">            <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//é€šè¿‡åå°„ç”Ÿæˆæ‹¦æˆªå™¨å¯¹è±¡</span></span>
<span class="line">        <span class="token class-name">Interceptor</span> interceptor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Interceptor</span><span class="token punctuation">)</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>interceptorClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>interceptor<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> target<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//æ ¡éªŒé€šè¿‡</span></span>
<span class="line">            result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒåº¦çœŸå®å¯¹è±¡çš„æ–¹æ³•</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">//æ ¡éªŒä¸é€šè¿‡</span></span>
<span class="line">            interceptor<span class="token punctuation">.</span><span class="token function">around</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> target<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        interceptor<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> target<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//finally</span></span>
<span class="line">        <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// 7.æ‹¦æˆªå™¨</span></span>
<span class="line"><span class="token class-name">HelloWorld</span> proxy2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HelloWorld</span><span class="token punctuation">)</span> <span class="token class-name">InterceptorJdkProxy</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloWorldImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;com.learn.ssm.chapter2.reflect.MyInterceptor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">proxy2<span class="token punctuation">.</span><span class="token function">sayHelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line">* åå°„æ–¹æ³•å‰é€»è¾‘</span>
<span class="line">* å–ä»£äº†è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•</span>
<span class="line">* åå°„æ–¹æ³•åé€»è¾‘</span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_5-æ€»ç»“"><span>5.æ€»ç»“</span></a></h2><p>åŠ¨æ€ä»£ç†çš„æ„ä¹‰åœ¨äº<strong>åœ¨ä¸ä¿®æ”¹åŸå§‹å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå¢åŠ é¢å¤–çš„åŠŸèƒ½</strong>ã€‚</p><p>è¿™æ­£æ˜¯AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ€æƒ³çš„å®ç°åŸºç¡€ï¼Œä¹Ÿæ˜¯ç°ä»£Javaæ¡†æ¶ï¼ˆå¦‚Springï¼‰çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">åŸå§‹å¯¹è±¡ï¼šğŸï¼ˆä¸€ä¸ªå¹²å‡€çš„è‹¹æœï¼‰</span>
<span class="line">â†“</span>
<span class="line">åŠ¨æ€ä»£ç†ï¼šğŸ + ğŸ“¦ï¼ˆç»™è‹¹æœåŠ äº†ä¸ªåŒ…è£…ç›’ï¼‰</span>
<span class="line">        + ğŸ€ï¼ˆå†ç³»ä¸ªè´è¶ç»“ï¼‰</span>
<span class="line">        + ğŸ’ï¼ˆå†åŠ å¼ è´ºå¡ï¼‰</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ğŸ</strong>ï¼šåŸå§‹çš„ä¸šåŠ¡åŠŸèƒ½</li><li><strong>ğŸ“¦ğŸ€ğŸ’</strong>ï¼šä»£ç†æ·»åŠ çš„é¢å¤–åŠŸèƒ½ï¼ˆæ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨ç­‰ï¼‰</li><li><strong>å…³é”®</strong>ï¼šè‹¹æœæœ¬èº«æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œåªæ˜¯è¢«&quot;åŒ…è£…&quot;èµ·æ¥äº†</li></ul>`,24))])}const b=l(k,[["render",d]]),g=JSON.parse(`{"path":"/post/02_Dynamic_proxy.html","title":"åŠ¨æ€ä»£ç†æ¨¡å¼","lang":"zh-CN","frontmatter":{"title":"åŠ¨æ€ä»£ç†æ¨¡å¼","lang":"zh-CN","author":"fireworks99","date":"2025-04-11"},"git":{"updatedTime":1760594996000,"contributors":[{"name":"fireworks99","username":"fireworks99","email":"46671672+fireworks99@users.noreply.github.com","commits":4,"url":"https://github.com/fireworks99"}],"changelog":[{"hash":"c05645b5052a5152833eab40e824062f4f268bf5","time":1760594996000,"email":"46671672+fireworks99@users.noreply.github.com","author":"fireworks99","message":"'åŠ¨æ€ä»£ç†'"},{"hash":"de3323d090a166d596f5b2ec7c3fb61be31570a3","time":1744788734000,"email":"46671672+fireworks99@users.noreply.github.com","author":"fireworks99","message":"update Dynamic proxy"},{"hash":"d588774922eaf4a4a2c3d791137eafd12ed7b143","time":1744343102000,"email":"46671672+fireworks99@users.noreply.github.com","author":"fireworks99","message":"'åŠ¨æ€ä»£ç†'"},{"hash":"5b067c19d6c0a862babfcde14e2353da4673ce0a","time":1744334635000,"email":"46671672+fireworks99@users.noreply.github.com","author":"fireworks99","message":"Initial"}]},"filePathRelative":"post/02_Dynamic_proxy.md"}`);export{b as comp,g as data};
